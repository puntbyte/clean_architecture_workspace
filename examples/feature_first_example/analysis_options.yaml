# feature_first_example/analysis_options.yaml

formatter:
  page_width: 100

analyzer:
  plugins:
    - custom_lint
  language:
    strict-casts: true
    strict-inference: true
    strict-raw-types: true

custom_lint:
  rules:
    # --- ENABLE ALL LINT RULES ---

    # --- Contract Rules ---
    - enforce_entity_contract: true
    - enforce_usecase_contract: true
    - enforce_port_contract: true
    - enforce_repository_contract: true
    - enforce_custom_contract: true

    # --- Dependency Rules ---
    - disallow_model_in_domain: true
    - disallow_flutter_in_domain: true

    - disallow_entity_in_source: true
    - disallow_public_members_in_implementation: true

    - disallow_repository_in_presentation: true
    - disallow_usecase_in_widget: true

    - disallow_dependency_instantiation: true
    - disallow_service_locator: true


    # --- Inheritance Rules ---
    - enforce_model_abstraction: true
    - enforce_source_implementation_abstraction: true
    - enforce_repository_abstraction: true

    - require_model_to_entity_method: true

    # --- Location Rules ---
    - enforce_file_and_folder_location: true
    - enforce_layer_independence: true

    # --- Type Safety Rules ---
    - disallow_model_return_from_repository: true
    - enforce_type_safety: true

    # --- Error Handling Rules ---
    - enforce_try_catch_in_repository: true
    - enforce_trowing_exception_on_source_implementation: true
    - convert_exceptions_to_failures: true
    - disallow_throwing_from_repository: true
    - disallow_throwing_from_presentation: true

    # --- Naming Convention Rules ---
    - enforce_antipattern_matching: true
    - enforce_pattern_matching: true
    - enforce_semantic_naming: true

    # --- Structure Rules ---
    - enforce_annotations: true
    - missing_use_case: true

    # --- CONFIGURATION BLOCK ---
    - clean_architecture:
      # [module_definitions] Define the high-level project structure.
      module_definitions:
        type: 'feature_first' # or 'layer_first'
        core: 'core'
        features: 'features'

        # layers can be used for both feature_first and layer_first naming.
        # all layer components accept a single string or a list of strings.
        layers:
          domain: 'domain'
          data: 'data'
          presentation: 'presentation'

      # [layer_definitions] Define directory names for architectural components.
      layer_definitions:
        domain:
          entity: 'entities'
          ports: 'ports'
          usecase: 'usecases'

        data:
          model: 'models'
          source: 'sources'
          repository: 'repositories'

        presentation:
          manager: ['managers', 'bloc', 'cubit']
          widget: 'widgets'
          page: 'pages'

      # [inheritances] is a configuration used for contract and abstraction lints.
      # Inheritance can be required, forbidden, or allowed.
      # [on] parameter is used for targeting the architectural component.
      # [required] parameter is used for must have inheritances and can be a list.
      # [forbidden] parameter is used for must not have inheritances and can be a list.
      # [allowed] parameter is used for may have inheritances and can be a list.
      # [name] parameter is used for the name of the inherited class name.
      # [import] parameter is used for the import of the inherited class.
      # [component] parameter is used for the in inherited architectural component.
      # It can not be used in combination with [name] and [import].
      inheritances:
        # --- Domain Layer ---
        # The default rule used for [enforce_entity_contract].
        # Defining not required unless for overringing the values.
        - on: entity
          required:
            name: 'Entity'
            import: 'package:feature_first_example/core/entity/entity.dart'

        # The default rule used for [enforce_port_contract].
        # Defining not required unless for overringing the values.
        - on: port
          required:
            name: 'Port'
            import: 'package:feature_first_example/core/port/port.dart'

        # The default rule used for [enforce_usecase_contract].
        # Defining not required unless for overringing the values.
        - on: usecase
          required:
            type: ['usecase.unary', 'usecase.nullary']

        # --- Data Layer ---
        # The default rule used for [enforce_abstracting_model].
        # Defining is not required unless for overringing the values.
        - on: model
          required:
            component: 'entity'

        # The default rule used for [enforce_source_contract].
        # Defining is not required unless for overringing the values.
        - on: source.interface
          required:
            name: 'Source'
            import: 'package:feature_first_example/core/source/source.dart'

        # The default rule used for [enforce_abstracting_source_implementation].
        # Defining not required unless for overringing the values.
        - on: source.implementation
          required:
            component: 'source.interface'

        # The default rule used for [enforce_abstracting_repository].
        # Defining is not required unless for overringing the values.
        - on: repository
          required:
            component: 'port'

        # --- Presentation Layer ---
        # User default rule for [enforce_custom_inheritance].
        # Defining is required in order the lint to work.
        - on: manager
          allowed:
            name: ['Bloc', 'Cubit']
            import: 'package:bloc/bloc.dart'

        # User default rule for [enforce_custom_inheritance].
        # Defining is required in order the lint to work.
        - on: widget
          allowed:
            name: 'HookWidget'
            import: 'package:flutter_hooks/flutter_hooks.dart'

        # User default rule for [enforce_custom_inheritance].
        # Defining is required in order the lint to work.
        - on: page
          forbidden:
            name: 'StatefulWidget'
            import: 'package:flutter/widgets.dart'

      # [naming_conventions] configuration is primarily used in [enforce_pattern_matching],
      # [enforce_antipattern_matching], and [enforce_semantic_naming] lints.
      # [on] parameter is used for targeting the architectural component.
      # [pattern] parameter is used to define pattern to match.
      # [antipattern] parameter is used to define antipattern to match.
      # [grammar] is a parameter used for semantic naming.
      # [name] is a builtin placeholder used in all the 3 parameters for the name of the component.
      # [affix] is a builtin placeholder used in all the 3 parameters for the affix of the component.
      # [noun], [noun.phrase], [noun.singular], [noun.plural], [verb], [verb.present], [verb.past],
      # [preposition], etc. are builtin grammar placeholder is used for the phrase of the component.
      naming_conventions:
        # --- Domain Layer ---
        # This is the default rule used for Entity.
        # Defining is not required unless for overringing the values.
        - on: entity
          pattern: '{{name}}'
          antipattern: '{{name}}Entity'
          grammar: '{{noun.phrase}}'

        # This is the default rule used for Port aka Repository Interface.
        # Defining is not required unless for overringing the values.
        - on: port
          pattern: '{{name}}Port'
          grammar: '{{noun.phrase}}Port'

        # This is the default rule used for Usecase.
        # Defining is not required unless for overringing the values.
        - on: usecase
          pattern: '{{name}}'
          antipattern: '{{name}}Use(C|c)ase'
          grammar: '{{verb.present}}{{noun.phrase}}Use(C|c)ase'

        # This is the default rule used for Usecase parameter.
        # Defining is not required unless for overringing the values.
        - on: usecase.parameter
          pattern: '_{{name}}Param'

        # --- Data Layer ---
        # This is the default rule used for Model.
        # Defining is not required unless for overringing the values.
        - on: model
          pattern: '{{name}}Model'
          grammar: '{{noun.phrase}}Model'

        # These are the default two rules used for Source Interface & Implementation.
        # Defining is not required unless for overringing the values.
        - on: source.interface
          pattern: '{{name}}Source'
          grammar: '{{noun.phrase}}Source'
        - on: source.implementation
          pattern: '{{affix}}{{name}}Source'
          grammar: '{{affix}}{{noun.phrase}}Source'

        # This is the default rule used for Repository aka Repository Implementation.
        # Defining is not required unless for overringing the values.
        - on: repository
          pattern: '{{affix}}{{name}}Repository'

        # --- Presentation Layer ---
        # These are the default five rules used for Manager.
        # Defining is not required unless for overringing the values
        - on: manager
          pattern: '{{name}}(Bloc|Cubit|Manager)'
          grammar: '{{noun.phrase}}(Bloc|Cubit|Manager)'
        - on: event.interface
          pattern: '{{name}}Event'
          grammar: '{{noun.phrase}}Event'
        - on: event.implementation
          pattern: '{{name}}'
          grammar: '{{subject}}{{noun.phrase}}?{{verb.past}}'
        - on: state.interface
          pattern: '{{name}}State'
          grammar: '{{noun.singular}}State'
        - on: state.implementation
          pattern: '{{name}}'
          grammar: '{{subject}}({{adjective}}|{{verb.gerund}}|{{verb.past}})'

        # This is the default rule used for Widget.
        # Defining is not required unless for overringing the values
        - on: widget
          pattern: '{{name}}(Form|Panel|Section|Widget)'
          grammar: '{{noun.phrase}}(Form|Panel|Section|Widget)'

        # This is the default rule used for Page.
        # Defining is not required unless for overringing the values
        - on: page
          pattern: '{{name}}Page'
          grammar: '{{noun.phrase}}Page'

      dependencies:
        # --- Domain Layer ---
        # The default rule used for [no_flutter_in_domain_layer].
        # Defining is not required unless for overringing the values.
        - on: domain
          forbidden:
            package: ['package:flutter/**', 'dart:ui']

        # The default rule used for [entity_in_domain_layer].
        # Defining is not required unless for overringing the values.
        - on: entity
          allowed:
            component: ['domain', 'manager']

        # The default rule used for [port_in_repository].
        # Defining is not required unless for overringing the values.
        - on: port
          allowed:
            component: ['entity', 'repository']

        # The default rule used for [usecase_in_repository].
        # Defining is not required unless for overringing the values.
        - on: usecase
          allowed:
            component: ['entity', 'port']

        # --- Data Layer ---
        # The default rule used for [model_in_data_layer].
        # Defining is not required unless for overringing the values.
        - on: model
          allowed:
            component: 'data'

        # The default two rules used for [source_in_repository].
        # Defining is not required unless for overringing the values.
        - on: source.interface
          allowed:
            component: 'source.implementation'
        - on: source.implementation
          allowed:
            component: 'repository'

        # The default rule used for [repository_in_data_layer].
        # Defining is not required unless for overringing the values.
        - on: repository
          allowed:
            component: 'data'

        # --- Presentation Layer ---
        # The default rule used for [manager_in_user_interface].
        # Defining is not required unless for overringing the values.
        - on: ['manager', 'event', 'state']
          allowed:
            component: ['widget', 'page']

        # The default rule used for [widget_in_user_interface].
        # Defining is not required unless for overringing the values.
        - on: 'widget'
          allowed:
            component: ['widget', 'page']

        # The default rule used for [page_in_user_interface].
        # Defining is not required unless for overringing the values.
        - on: 'page'
          allowed:
            component: ['page', 'core']

      # Default types used in [type_safeties] and [error_handlers] configurations.
      # Defining is not required unless for overringing values.
      type_definitions:
        # --- Domain Failures ---
        usecase:
          - key: 'base'
            name: 'Usecase'
            import: 'package:feature_first_example/core/usecase/usecase.dart'
          - key: 'nullary'
            name: 'NullaryUsecase'
          - key: 'unary'
            name: 'UnaryUsecase'

        failure:
          - key: 'base'
            name: 'Failure'
            import: 'package:feature_first_example/core/error/failures.dart'
          - key: 'server'
            name: 'ServerFailure'
          - key: 'cache'
            name: 'CacheFailure'

        # --- Data Exceptions ---
        exception:
          - key: 'raw'
            name: 'Exception'
          - key: 'base'
            name: 'CustomException'
            import: 'package:feature_first_example/core/error/exceptions.dart'
          - key: 'server'
            name: 'ServerException'
          - key: 'cache'
            name: 'CacheException'

        # --- Functional Results (Wrappers) ---
        result:
          - key: 'future'
            name: 'Future'
          - key: 'wrapper'
            name: 'FutureEither'
            import: 'package:feature_first_example/core/utils/types.dart'
          - key: 'success'
            name: 'Right'
            import: 'package:fpdart/fpdart.dart'
          - key: 'failure'
            name: 'Left'
            import: 'package:fpdart/fpdart.dart'

        # --- Value Objects (Identity) ---
        custom:
          - key: 'identity.integer'
            name: 'IntId'
            import: 'package:feature_first_example/core/utils/types.dart'
          - key: 'identity.string'
            name: 'StringId'
            import: 'package:feature_first_example/core/utils/types.dart'

      type_safeties:
        - on: [ port, usecase ]
          allowed:
            kind: 'return'
            #definition: 'result.wrapper' # optional way to defining type and import
            type: 'FutureEither'
            import: 'package:feature_first_example/core/utils/types.dart'
          forbidden:
            kind: 'return'
            #definition: 'result.future' # optional way to defining type and import
            type: 'Future'

        - on: source
          allowed:
            kind: 'return'
            #definition: 'result.future' # optional way to defining type and import
            type: 'Future'

          forbidden:
            kind: 'return'
            #definition: 'result.wrapper' # optional way to defining type and import
            type: 'FutureEither'
            import: 'package:feature_first_example/core/utils/types.dart'

        - on: repository
          forbidden:
            kind: 'return'
            component: 'model'

        - on: [ port, usecase, source, repository ]
          allowed:
            - kind: 'parameter'
              identifier: 'id'
              type: 'IntId'
              # definition: 'identity.integer' # optional way to defining type and import
              import: 'package:feature_first_example/core/utils/types.dart'
            - kind: 'parameter'
              identifier: 'id'
              # definition: 'identity.string' # optional way to defining type and import
              type: 'StringId'
              import: 'package:feature_first_example/core/utils/types.dart'
          forbidden:
            - kind: 'parameter'
              identifier: 'id'
              type: 'int'
            - kind: 'parameter'
              identifier: 'id'
              type: 'String'

      # [3] ERROR HANDLING: Control Flow & Logic Enforcement
      error_handlers:
        # --- 1. The Producer (Data Source) ---
        # Default rule used for [exception_on_source_implementation].
        # Defining is not required unless for overringing the default values.
        # Responsible for interacting with external worlds and throwing specific exceptions.
        - on: source.implementation
          role: 'producer'
          required:
            # Must have a try block which returns any Object
            - operation: 'try_return'
              target_type: 'Object'
            # Must have a catch block which throws a subtype of CustomException
            - operation: 'catch_throw'
              target_type: 'exception.base'
          forbidden:
            # Never throw a raw Dart Exception directly.
            operation: 'throw'
            target_type: 'exception.raw'

        # --- 2. The Boundary (Repository) ---
        # Default rule used for [no_throwing_from_repository], [try_catch_in_repository], and
        # [convert_exceptions_to_failures].
        # Defining is not required unless for overringing the default values.
        # Responsible for catching Exceptions and converting them to Failures.
        - on: repository
          role: 'boundary'
          # If one of try_** or catch_** is defined, must have try_catch bloc automatically applied.
          required:
            # Must have a try block which returns a subtype of Either
            - operation: 'try_return'
              target_type: 'result.success'
            # Must have a catch block which returns a subtype of Failure
            - operation: 'catch_return'
              target_type: 'result.failure'
          forbidden:
            # Never let an exception escape the repository.
            operation: ['throw', 'rethrow']

          # Enforce 1-to-1 mapping between Data Errors and Domain Failures
          conversions:
            # Convert ServerException to ServerFailure.
            - from_type: 'exception.server'
              to_type: 'failure.server'
            # Convert CacheException to CacheFailure
            - from_type: 'exception.cache'
              to_type: 'failure.cache'
            # A fallback to convert Exception or CustomException to Generic Failure.
            - from_type: 'exception.base'
              to_type: 'failure.base'

        # --- 3. The Consumer (Presentation) ---
        # Default rule used for [no_throwing_from_presentation].
        # Defining is not required unless for overringing the default values.
        # Responsible for mapping Failures to user messages/states.
        - on: presentation
          role: 'consumer'
          forbidden:
            # Must not throw or rethrow any subtype of dart Exception.
            operation: ['throw', 'rethrow']
            target_type: 'exception.raw'

      annotations:
        # --- Domain Layer ---
        # User defined rule used for [enforce_annotation].
        # Defining is required in order the lint to work.
        - on: entity
          forbidden:
            name: [ 'Injectable', 'LazySingleton' ]
            import: 'package:injectable/injectable.dart'

        # User defined rule used for [enforce_annotation].
        # Defining is required in order the lint to work.
        - on: usecase
          required:
            name: 'injectable'
            import: 'package:injectable/injectable.dart'

        # --- Data Layer ---
        # User defined rule used for [enforce_annotation].
        # Defining is required in order the lint to work.
        - on: model
          allowed:
            - name: 'freezed'
              import: 'package:freezed_annotation/freezed_annotation.dart'
            - name: 'MappableClass'
              import: 'package:dart_mappable/dart_mappable.dart'

        # User defined rule used for [enforce_annotation].
        # Defining is required in order the lint to work.
        - on: repository
          required:
            name: ['LazySingleton', 'Singleton']
            import: 'package:injectable/injectable.dart'
          allowed:
            name: 'WithCache'
            import: 'package:cached_annotation/cached_annotation.dart'

      # Configuration for service-related lints.
      services:
        # The default rule used for [disallow_service_locator].
        # Defining is not required unless for overringing the values.
        service_locator:
          name: ['getIt', 'locator']
          import: 'package:feature_first_example/core/utils/service_locator.dart'
